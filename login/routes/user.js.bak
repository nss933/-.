const express=require("express")
const pool=require("../pool.js")
const r=express.Router()
	//用户注册接口（post/reg）
	//接口地址：http://127.0.0.1:3000/v1/users/reg
	//请求方式：post
r.post("/reg",(req,res,next)=>{
	var obj=req.body
	console.log(obj)
	//验证手机号码格式
	if(!/^1[3-9]\d{9}$/.test(obj.phone)){
		res.send({code:401,msg:"手机号码格式错误"})
		return 
	}
	//执行SQL命令，插入数据
	pool.query("insert into xz_user set ?",[obj],(err,r)=>{
		if(err){
//如果SQL中有错误，交给下一个错误处理中间件
		next(err)
//阻止往后执行
		return 
		}
		console.log(r)
		res.send({code:200,msg:"注册成功"})
	})
})
module.exports=r